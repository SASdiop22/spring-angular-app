<div class="admin-dashboard">
  <!-- En-tête -->
  <div class="header">
    <h1><i class="fas fa-shield-alt"></i> Tableau de bord Admin</h1>
    <button class="btn btn-outline-secondary" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Retour
    </button>
  </div>

  <!-- Messages d'erreur -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show">
    <i class="fas fa-exclamation-circle"></i> {{ error }}
    <button type="button" class="btn-close" (click)="error = null"></button>
  </div>

  <!-- Chargement -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-3 text-muted">Chargement en cours...</p>
  </div>

  <!-- Onglets -->
  <div class="tabs mb-4">
    <button
      class="btn"
      [class.btn-primary]="activeTab === 'users'"
      [class.btn-outline-primary]="activeTab !== 'users'"
      (click)="switchTab('users')"
    >
      <i class="fas fa-users"></i> Utilisateurs ({{ users.length }})
    </button>
    <button
      class="btn"
      [class.btn-primary]="activeTab === 'joboffers'"
      [class.btn-outline-primary]="activeTab !== 'joboffers'"
      (click)="switchTab('joboffers')"
    >
      <i class="fas fa-briefcase"></i> Offres d'emploi ({{ jobOffers.length }})
    </button>
  </div>

  <!-- Section Utilisateurs -->
  <div *ngIf="activeTab === 'users' && !loading" class="users-section">
    <h2>Gestion des utilisateurs</h2>

    <div *ngIf="users.length === 0" class="alert alert-info">
      Aucun utilisateur trouvé
    </div>

    <div *ngIf="users.length > 0" class="table-responsive">
      <table class="table table-hover">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Nom d'utilisateur</th>
            <th>Email</th>
            <th>Rôles</th>
            <th>Type</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td>{{ user.id }}</td>
            <td>
              <strong>{{ user.username }}</strong>
            </td>
            <td>{{ user.email }}</td>
            <td>
              <span class="badge bg-info">{{ getRoleLabel(user.roles) }}</span>
            </td>
            <td>{{ user.userType }}</td>
            <td>
              <button
                class="btn btn-sm btn-danger"
                (click)="confirmDeleteUser(user)"
                [disabled]="loading"
              >
                <i class="fas fa-trash"></i> Supprimer
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Section Offres d'emploi -->
  <div *ngIf="activeTab === 'joboffers' && !loading" class="joboffers-section">
    <h2>Gestion des offres d'emploi</h2>

    <div *ngIf="jobOffers.length === 0" class="alert alert-info">
      Aucune offre d'emploi trouvée
    </div>

    <div *ngIf="jobOffers.length > 0" class="table-responsive">
      <table class="table table-hover">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Titre</th>
            <th>Département</th>
            <th>Statut</th>
            <th>Candidatures</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let offer of jobOffers">
            <td>{{ offer.id }}</td>
            <td>
              <strong>{{ offer.title }}</strong>
            </td>
            <td>{{ offer.department }}</td>
            <td>
              <span class="badge" [ngClass]="'bg-' + getOfferStatusClass(offer.status)">
                {{ getStatusLabel(offer.status) }}
              </span>
            </td>
            <td>{{ offer.candidatesCount || 0 }}</td>
            <td>
              <button
                class="btn btn-sm btn-warning"
                (click)="archiveOffer(offer)"
                [disabled]="loading || offer.status === 'CLOSED'"
              >
                <i class="fas fa-archive"></i> Archiver
              </button>
              <button
                class="btn btn-sm btn-danger"
                (click)="confirmDeleteOffer(offer)"
                [disabled]="loading"
              >
                <i class="fas fa-trash"></i> Supprimer
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal de confirmation suppression utilisateur -->
  <div class="modal" [class.show]="showConfirmDeleteUser" [style.display]="showConfirmDeleteUser ? 'block' : 'none'">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title">
            <i class="fas fa-exclamation-triangle"></i> Confirmer la suppression
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            (click)="cancelDeleteUser()"
          ></button>
        </div>
        <div class="modal-body">
          <p>
            ⚠️ Êtes-vous sûr de vouloir supprimer définitivement
            <strong>{{ selectedUserForDelete?.username }}</strong> ?
          </p>
          <p class="text-danger small">
            ⚠️ <strong>Attention:</strong> Cette action est irréversible et supprimera tous les
            données associées à cet utilisateur (candidatures, profil, etc.)
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelDeleteUser()">
            <i class="fas fa-times"></i> Annuler
          </button>
          <button class="btn btn-danger" (click)="deleteUserConfirmed()" [disabled]="loading">
            <i class="fas fa-trash"></i> Supprimer définitivement
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de confirmation suppression offre -->
  <div class="modal" [class.show]="showConfirmDeleteOffer" [style.display]="showConfirmDeleteOffer ? 'block' : 'none'">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title">
            <i class="fas fa-exclamation-triangle"></i> Confirmer la suppression
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            (click)="cancelDeleteOffer()"
          ></button>
        </div>
        <div class="modal-body">
          <p>
            ⚠️ Êtes-vous sûr de vouloir supprimer définitivement
            <strong>{{ selectedOfferForDelete?.title }}</strong> ?
          </p>
          <p class="text-danger small">
            ⚠️ <strong>Attention:</strong> Cette action est irréversible et supprimera
            toutes les candidatures associées à cette offre.
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelDeleteOffer()">
            <i class="fas fa-times"></i> Annuler
          </button>
          <button class="btn btn-danger" (click)="deleteOfferConfirmed()" [disabled]="loading">
            <i class="fas fa-trash"></i> Supprimer définitivement
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Backdrop -->
  <div
    class="modal-backdrop fade"
    [class.show]="showConfirmDeleteUser || showConfirmDeleteOffer"
    *ngIf="showConfirmDeleteUser || showConfirmDeleteOffer"
  ></div>
</div>

